import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
import openpyxl

#Load the Excel file
def load_data(filepath):
    return pd.read_excel(filepath)
"Load excel file "

#Data Cleaning:
"cleaning data by using the inbuilt functions isnull().sum(),drop_duplicates(),fillna(0),astype(datatype)"
def clean_data(df):
    #1.missing values:
    print("Missing values per column:\n", df.isnull().sum())
    #2.Drop Duplicate rows
    df = df.drop_duplicates()
    #3.Change datatype:
    df['Matches'] = df['Matches'].fillna(0).astype(int)
    #drop null values
    df = df.fillna(0)
    return df

#Data Analysis:
"Data analysis means to perform the operation on data using the userdefine or inbuilt functions like find average,mean etc."
def analyze_data(df):
    #1.Average price of palyers:
    print("Average Price:", df['Price'].mean())
    #2.count the players based on brand:
    print("Brand Distribution:\n", df['Brand'].value_counts())
    #3.maximum rating of the player:
    print("Max Rating:", df['Rating'].max())
    #4.minimum rating of the player:
    print("Min Rating:", df['Rating'].min())
    #Group the values acoording to the team
    grouped = df.groupby('Team')['Runs'].sum()
    print("Total Runs by Team:\n", grouped)
    #retiurn the sort data to the main
    return df.sort_values(by='Rating', ascending=False)

#save the modified file:
def save_data(df, output_path):
   df.to_excel(output_path, index=False)

# Charts:
#Bar chart:
def plot_brand_distribution(df):
    df['Brand'].value_counts().plot(kind='bar', title='Brand Distribution')
    "we count brand means no of brands"
    plt.xlabel('Brand')
    plt.ylabel('Count')
    plt.tight_layout()
    plt.show()

#Pie Chart:
def plot_rating_distribution(df):
    df['Rating'].value_counts().plot(kind='pie', autopct='%1.1f%%', title='Rating Distribution')
    plt.ylabel('')
    plt.tight_layout()
    plt.show()

#Line chart:
def plot_runs_vs_matches(df):
    plt.plot(df['Matches'], df['Runs'], marker='o')
    plt.title('Runs vs Matches')
    plt.xlabel('Matches')
    plt.ylabel('Runs')
    plt.grid(True)
    plt.show()

#Scatter plot:
def plot_matches_by_player(df):
    sns.scatterplot(x='Player', y='Matches', data=df)
    plt.title('Matches Played by Each Player')
    plt.xlabel('Player')
    plt.ylabel('Matches')
    plt.xticks(rotation=90)
    plt.tight_layout()
    plt.show()

#Main Function:
def main():
    df = load_data('ipl_palyers.xlsx')
    df = clean_data(df)
    df_sorted = analyze_data(df)
    save_data(df_sorted, 'ipl_palyers_cleaned.xlsx')
    plot_brand_distribution(df)
    plot_rating_distribution(df)
    plot_runs_vs_matches(df)
    plot_matches_by_player(df)

if __name__ == "__main__":
    main()
